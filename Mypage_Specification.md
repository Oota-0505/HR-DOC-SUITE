# 会員マイページ機能 仕様書

**更新日**: 2026年1月16日  
**対象ファイル**: `hrdocsuite/page-templates/page-mypage.php`

---

## 1. 概要

### 1.1 マイページの位置づけ

本サービスでは、**契約状況・提供物・サポートへのアクセスを目的とした「簡易マイページ」** を提供する。

| 項目 | 内容 |
|-----|------|
| システム種別 | 表示用ページ（SaaS型自動管理システムではない） |
| 管理方式 | 運営側による手動管理を前提 |
| API連携 | 決済サービス・外部ツールとのAPI連携なし |
| データ同期 | 自動更新・同期処理は行わない |
| 正式情報 | 決済サービスからの通知内容を正とする |

### 1.2 重要な注意事項

> ⚠️ 本マイページは「業務補助・確認用UI」であり、自動処理・分析・判断・生成を行うSaaSではありません。  
> 表示情報と実際の契約・決済状態が異なる場合、**決済サービスからの通知内容を正とします**。

---

## 2. ページ構成

```
┌─────────────────────────────────────────────────────────────┐
│  【ヘッダー】                                                │
│  ロゴ + 検索フィールド + ユーザー名 + ログアウト              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. アカウント情報（ユーザー編集可能）                        │
│                                                             │
│  2. ステータス表示                                           │
│                                                             │
│  3. 申込履歴（閲覧のみ）                                      │
│                                                             │
│  4. 請求情報（閲覧のみ）                                      │
│                                                             │
│  5. ダウンロード資料                                         │
│                                                             │
│  6. サポート機能                                             │
│                                                             │
│  7. 退会・アカウント削除                                      │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  【フッター注意書き】                                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 各セクション詳細仕様

### 3.1 ヘッダー

| 要素 | 仕様 |
|-----|------|
| ロゴ | サイトトップへのリンク |
| 検索フィールド | ダウンロード資料・ガイド等の簡易検索（高度な全文検索・AI検索なし） |
| ユーザー名 | ログイン中のユーザー名を表示 |
| ログアウトボタン | ログアウト処理を実行 |
| 管理者バッジ | 管理者ユーザーの場合のみ表示 |
| ユーザー切替リンク | 管理者のみ表示（select-userページへ遷移） |

---

### 3.2 アカウント情報

#### 表示・編集項目

| 項目 | 編集可否 | 備考 |
|-----|---------|------|
| 氏名 | ✅ 編集可 | |
| メールアドレス（ログインID） | ✅ 編集可 | ログインIDとして使用 |
| 電話番号 | ✅ 編集可 | 任意項目 |
| 住所 | ✅ 編集可 | 必要時のみ使用 |
| パスワード変更 | ✅ 編集可 | パスワード変更フォーム表示 |

#### 仕様

- ユーザー自身が編集可能
- パスワードはマスク表示（`********`）
- パスワード管理は認証システム側（WordPress）に依存
- サイト側でパスワードを保持・表示しない
- 保存ボタン押下でデータベースを更新

---

### 3.3 ステータス表示

#### 表示ステータス一覧

| ステータス | 説明 |
|-----------|------|
| 受付済 | 申込を受け付けた状態 |
| 決済確認済 | 決済完了を確認した状態 |
| 提供中 | サービス提供中の状態 |
| 解約申請中 | 解約申請を受け付けた状態 |
| 解約済 | 解約処理が完了した状態 |

#### 仕様

- ステータスは運営側が管理画面から手動で更新
- 自動切替・自動更新は行わない
- 現在のステータスを視覚的に強調表示

---

### 3.4 申込履歴

#### 表示項目

| 項目 | 表示内容 |
|-----|---------|
| 申込日 | YYYY/MM/DD形式 |
| プラン名 | 契約プラン名 |
| 決済金額 | 税込金額 |
| 決済方法 | クレジットカード/銀行振込等 |
| ステータス | 上記ステータス一覧参照 |

#### 仕様

- **決済サービスとのAPI連携なし**
- 決済完了メールをもとに、運営が管理画面から手動登録
- ユーザー側は閲覧のみ（編集不可）
- 複数の申込履歴がある場合はリスト形式で表示

---

### 3.5 請求情報（手動管理）

#### 表示項目

| 項目 | 表示内容 |
|-----|---------|
| 今月の請求額 | 税込金額 |
| 支払い履歴 | 過去の支払い一覧 |
| 次回更新日 | YYYY/MM/DD形式 |

#### 仕様

- 表示内容は運営が管理画面から手動入力
- クレジットカード番号・決済情報は**一切保持しない**
- 実際の決済処理・カード情報管理はPSP（決済代行会社）に完全委任

---

### 3.6 ダウンロード資料

#### 表示内容

| 種類 | 内容 |
|-----|------|
| 利用ガイドPDF | サービス利用方法の説明 |
| 提供資料 | テンプレート・成果物 |
| 特典PDF | 契約特典として提供する資料 |

#### 仕様

- ファイルは運営が管理画面から手動アップロード
- **プランごとの表示制御が可能**
- 自動配信・自動生成機能は持たない
- 検索フィールドでファイル名検索が可能

---

### 3.7 サポート機能

#### 3.7.1 お問い合わせフォーム

**入力項目**

| 項目 | 種別 | 選択肢 |
|-----|------|--------|
| 相談内容 | チェックボックス（複数選択可） | サブスク契約・解約 / サービス内容について / その他 |
| 詳細内容 | テキストエリア | 自由入力 |

**仕様**

- 問い合わせ内容はメールまたは管理画面へ通知
- 自動返信・AI対応などは行わない
- 選択内容に応じて、関連フィールドを表示（任意）

#### 3.7.2 LINEチャットサポート

| 項目 | 内容 |
|-----|------|
| リンク先 | FLOWGRAM公式LINE |
| 連携方式 | API連携なし（通常の外部リンク） |
| 表示 | LINEアイコン＋リンクボタン |

---

### 3.8 退会・アカウント削除

#### 表示項目

| 要素 | 内容 |
|-----|------|
| アカウント削除ボタン | 退会申請フォームへ遷移 |
| 注意書き | 削除後の利用不可・復元不可などの警告 |

#### 仕様

- ボタン押下で退会申請フォームへ遷移
- アカウント削除およびサブスクリプション停止は、**運営が手動で対応**
- 自動退会・自動解約処理は行わない
- 確認ダイアログを表示して誤操作を防止

---

## 4. 権限管理

### 4.1 一般ユーザー

| 操作 | 可否 |
|-----|------|
| アカウント情報の閲覧 | ✅ |
| アカウント情報の編集 | ✅ |
| 申込履歴の閲覧 | ✅ |
| 請求情報の閲覧 | ✅ |
| ダウンロード資料の閲覧・DL | ✅（プラン制限あり） |
| 問い合わせ送信 | ✅ |
| 退会申請 | ✅ |

### 4.2 管理者ユーザー

| 操作 | 可否 |
|-----|------|
| 一般ユーザーの全機能 | ✅ |
| 他ユーザーのページ閲覧 | ✅ |
| 申込履歴の編集 | ✅ |
| 請求情報の編集 | ✅ |
| ステータスの変更 | ✅ |
| ユーザー切替 | ✅ |

---

## 5. データベース設計

### 5.1 custom_users テーブル拡張

| カラム名 | 型 | 説明 |
|---------|-----|------|
| wp_user_id | int | WordPress ユーザーID |
| name | varchar | 氏名 |
| email | varchar | メールアドレス |
| phone | varchar | 電話番号 |
| address | text | 住所 |
| status | varchar | ステータス（受付済/決済確認済/提供中/解約申請中/解約済） |
| plan_name | varchar | 契約プラン名 |
| order_date | date | 申込日 |
| order_amount | int | 決済金額 |
| order_payment_method | varchar | 決済方法 |
| billing_current | int | 今月の請求額 |
| billing_next_date | date | 次回更新日 |
| created_at | datetime | 作成日時 |
| updated_at | datetime | 更新日時 |

---

## 6. セキュリティ要件

| 項目 | 対応 |
|-----|------|
| ログインチェック | 未ログイン時はログインページへリダイレクト |
| 権限チェック | 一般ユーザーは他人のページにアクセス不可 |
| CSRF対策 | WordPress nonce によるトークン検証 |
| XSS対策 | 出力時のエスケープ処理（esc_html, esc_attr） |
| SQLインジェクション対策 | プリペアドステートメント使用 |
| パスワード | サイト側で保持・表示しない |
| 決済情報 | カード番号等は一切保持しない |

---

## 7. UI/UX 設計指針

### 7.1 CSS設計

- **ページ専用CSS**: マイページ内でのみ有効なスコープ付きCSS
- **セレクタ強化**: `.mypage-` プレフィックスを使用し、他ページとの競合を防止
- **詳細度強化**: 必要に応じて `.mypage-container` を親セレクタとして使用

### 7.2 レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| PC (>1024px) | 通常レイアウト |
| タブレット (768px-1024px) | 2カラム→1カラム切替 |
| スマホ (<768px) | 完全1カラム、テーブル横スクロール |

### 7.3 アクセシビリティ

- フォームラベルの適切な関連付け
- キーボード操作対応
- 適切なコントラスト比

---

## 8. ファイル構成

```
hrdocsuite/
├── page-templates/
│   ├── page-mypage.php          # 新マイページ（本仕様）
│   ├── page-login.php
│   ├── page-register.php
│   └── page-select-user.php
├── css/
│   └── style.css
├── js/
│   └── main.js
└── pdfs/
    ├── guide.pdf
    └── bonus.pdf
```

---

## 9. 更新履歴

| 日付 | バージョン | 内容 |
|-----|-----------|------|
| 2026/01/16 | 1.0 | 初版作成 |
